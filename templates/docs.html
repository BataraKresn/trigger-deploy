{% extends "base.html" %}

{% block title %}API Documentation - Trigger Deploy{% endblock %}
{% block description %}Complete API reference and interactive documentation for Trigger Deploy{% endblock %}

{% set current_page = "docs" %}
{% set show_nav = true %}
{% set show_footer = true %}

{% block nav_controls %}
<a href="/docs/swagger" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition duration-200">
    <i class="fas fa-external-link-alt mr-1"></i>Swagger UI
</a>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 animate-fade-in">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 flex items-center">
            <i class="fas fa-book mr-3 text-blue-500"></i>
            API Documentation
        </h1>
        <p class="text-gray-600 mt-2">Complete API reference and interactive documentation</p>
    </div>

    <!-- Quick Navigation -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <a href="#authentication" class="bg-white rounded-xl p-6 border-l-4 border-blue-500 shadow-sm hover:shadow-md transition duration-200 block">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                    <i class="fas fa-key text-blue-600 text-xl"></i>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-900">Authentication</h3>
                    <p class="text-sm text-gray-600">JWT & Token Auth</p>
                </div>
            </div>
        </a>

        <a href="#deployment" class="bg-white rounded-xl p-6 border-l-4 border-green-500 shadow-sm hover:shadow-md transition duration-200 block">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4">
                    <i class="fas fa-rocket text-green-600 text-xl"></i>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-900">Deployment</h3>
                    <p class="text-sm text-gray-600">Deploy APIs</p>
                </div>
            </div>
        </a>

        <a href="#monitoring" class="bg-white rounded-xl p-6 border-l-4 border-purple-500 shadow-sm hover:shadow-md transition duration-200 block">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mr-4">
                    <i class="fas fa-chart-line text-purple-600 text-xl"></i>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-900">Monitoring</h3>
                    <p class="text-sm text-gray-600">Health & Metrics</p>
                </div>
            </div>
        </a>

        <a href="#management" class="bg-white rounded-xl p-6 border-l-4 border-orange-500 shadow-sm hover:shadow-md transition duration-200 block">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mr-4">
                    <i class="fas fa-cog text-orange-600 text-xl"></i>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-900">Management</h3>
                    <p class="text-sm text-gray-600">User & Server APIs</p>
                </div>
            </div>
        </a>
    </div>

    <!-- API Sections -->
    <div class="space-y-8">
        <!-- Authentication Section -->
        <section id="authentication" class="bg-white rounded-xl shadow-sm overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 bg-blue-50">
                <h2 class="text-xl font-semibold text-gray-900 flex items-center">
                    <i class="fas fa-key mr-2 text-blue-500"></i>
                    Authentication
                </h2>
            </div>
            <div class="p-6">
                <p class="text-gray-600 mb-6">Trigger Deploy uses JWT tokens for authentication. Include the token in the Authorization header.</p>
                
                <div class="space-y-6">
                    <!-- Login Endpoint -->
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-semibold text-gray-900">Login</h3>
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">POST</span>
                        </div>
                        <code class="block bg-gray-100 p-3 rounded mb-3 text-sm">/api/auth/login</code>
                        <div class="bg-gray-50 p-3 rounded">
                            <h4 class="font-medium mb-2">Request Body:</h4>
                            <pre class="text-sm text-gray-700">{
  "username": "admin",
  "password": "your_password"
}</pre>
                        </div>
                    </div>

                    <!-- Token Usage -->
                    <div class="border rounded-lg p-4">
                        <h3 class="font-semibold text-gray-900 mb-3">Using Tokens</h3>
                        <p class="text-gray-600 mb-3">Include the token in all authenticated requests:</p>
                        <code class="block bg-gray-100 p-3 rounded text-sm">Authorization: Bearer YOUR_JWT_TOKEN</code>
                    </div>
                </div>
            </div>
        </section>

        <!-- Deployment Section -->
        <section id="deployment" class="bg-white rounded-xl shadow-sm overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 bg-green-50">
                <h2 class="text-xl font-semibold text-gray-900 flex items-center">
                    <i class="fas fa-rocket mr-2 text-green-500"></i>
                    Deployment APIs
                </h2>
            </div>
            <div class="p-6">
                <div class="space-y-6">
                    <!-- Deploy Endpoint -->
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-semibold text-gray-900">Deploy to Server</h3>
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">POST</span>
                        </div>
                        <code class="block bg-gray-100 p-3 rounded mb-3 text-sm">/api/deploy/trigger</code>
                        <div class="bg-gray-50 p-3 rounded">
                            <h4 class="font-medium mb-2">Request Body:</h4>
                            <pre class="text-sm text-gray-700">{
  "server": "production",
  "service": "web-app",
  "branch": "main",
  "force": false
}</pre>
                        </div>
                    </div>

                    <!-- Get Servers -->
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-semibold text-gray-900">List Servers</h3>
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium">GET</span>
                        </div>
                        <code class="block bg-gray-100 p-3 rounded text-sm">/api/servers</code>
                    </div>
                </div>
            </div>
        </section>

        <!-- Monitoring Section -->
        <section id="monitoring" class="bg-white rounded-xl shadow-sm overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 bg-purple-50">
                <h2 class="text-xl font-semibold text-gray-900 flex items-center">
                    <i class="fas fa-chart-line mr-2 text-purple-500"></i>
                    Monitoring & Health
                </h2>
            </div>
            <div class="p-6">
                <div class="space-y-6">
                    <!-- Health Check -->
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-semibold text-gray-900">System Health</h3>
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium">GET</span>
                        </div>
                        <code class="block bg-gray-100 p-3 rounded text-sm">/api/health/system</code>
                    </div>

                    <!-- Service Status -->
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-semibold text-gray-900">Service Status</h3>
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium">GET</span>
                        </div>
                        <code class="block bg-gray-100 p-3 rounded text-sm">/api/services/status</code>
                    </div>

                    <!-- Metrics -->
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-semibold text-gray-900">Metrics Data</h3>
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium">GET</span>
                        </div>
                        <code class="block bg-gray-100 p-3 rounded text-sm">/api/metrics?range=6h</code>
                    </div>
                </div>
            </div>
        </section>

        <!-- Management Section -->
        <section id="management" class="bg-white rounded-xl shadow-sm overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 bg-orange-50">
                <h2 class="text-xl font-semibold text-gray-900 flex items-center">
                    <i class="fas fa-cog mr-2 text-orange-500"></i>
                    User & Server Management
                </h2>
            </div>
            <div class="p-6">
                <div class="space-y-6">
                    <!-- Users -->
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-semibold text-gray-900">Manage Users</h3>
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium">GET/POST/PUT/DELETE</span>
                        </div>
                        <code class="block bg-gray-100 p-3 rounded text-sm">/api/users</code>
                    </div>

                    <!-- Configuration -->
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-semibold text-gray-900">Configuration</h3>
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium">GET/PUT</span>
                        </div>
                        <code class="block bg-gray-100 p-3 rounded text-sm">/api/config</code>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Interactive API Explorer -->
    <div class="mt-8 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-xl p-8 text-white">
        <div class="text-center">
            <h2 class="text-2xl font-bold mb-4">
                <i class="fas fa-code mr-2"></i>
                Interactive API Explorer
            </h2>
            <p class="text-blue-100 mb-6">Try our APIs directly with Swagger UI</p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="/docs/swagger" class="bg-white text-blue-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition duration-200">
                    <i class="fas fa-external-link-alt mr-2"></i>
                    Open Swagger UI
                </a>
                <a href="/static/openapi.json" target="_blank" class="border-2 border-white text-white px-6 py-3 rounded-lg font-semibold hover:bg-white hover:text-blue-600 transition duration-200">
                    <i class="fas fa-download mr-2"></i>
                    Download OpenAPI Spec
                </a>
            </div>
        </div>
    </div>

    <!-- Code Examples -->
    <div class="mt-8 bg-white rounded-xl shadow-sm overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-xl font-semibold text-gray-900">
                <i class="fas fa-code mr-2 text-indigo-500"></i>
                Code Examples
            </h2>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- cURL Example -->
                <div>
                    <h3 class="font-semibold text-gray-900 mb-3">cURL</h3>
                    <pre class="bg-gray-900 text-green-400 p-4 rounded-lg text-sm overflow-x-auto"><code># Login
curl -X POST http://localhost:3111/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'

# Deploy
curl -X POST http://localhost:3111/api/deploy/trigger \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"server":"production","service":"web-app"}'</code></pre>
                </div>

                <!-- JavaScript Example -->
                <div>
                    <h3 class="font-semibold text-gray-900 mb-3">JavaScript</h3>
                    <pre class="bg-gray-900 text-blue-400 p-4 rounded-lg text-sm overflow-x-auto"><code>// Login
const response = await fetch('/api/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    username: 'admin',
    password: 'admin123'
  })
});

const { token } = await response.json();

// Deploy
await fetch('/api/deploy/trigger', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    server: 'production',
    service: 'web-app'
  })
});</code></pre>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block footer_subtitle %}API documentation and developer resources{% endblock %}

{% block extra_js %}
<script>
    // Smooth scrolling for navigation
    document.addEventListener('DOMContentLoaded', function() {
        const navLinks = document.querySelectorAll('a[href^="#"]');
        
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    });

    // Copy code functionality
    function addCopyButtons() {
        const codeBlocks = document.querySelectorAll('pre code, pre');
        
        codeBlocks.forEach(block => {
            if (block.parentElement.style.position !== 'relative') {
                block.parentElement.style.position = 'relative';
                
                const copyBtn = document.createElement('button');
                copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
                copyBtn.className = 'absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-white px-2 py-1 rounded text-xs transition duration-200';
                copyBtn.onclick = () => {
                    navigator.clipboard.writeText(block.textContent);
                    copyBtn.innerHTML = '<i class="fas fa-check text-green-400"></i>';
                    setTimeout(() => {
                        copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
                    }, 2000);
                };
                
                block.parentElement.appendChild(copyBtn);
            }
        });
    }

    // Add copy buttons after page load
    document.addEventListener('DOMContentLoaded', addCopyButtons);
</script>
{% endblock %}
