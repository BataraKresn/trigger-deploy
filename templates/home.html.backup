<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🏠 Dashboard - Trigger Deploy Server</title>
  <link rel="icon" type="image/svg+xml" href="/static/images/favicon.svg">
  <link href="/static/css/styles.css" rel="stylesheet">
  <link href="/static/css/dashboard.css" rel="stylesheet">
  
  <!-- Contact Messages Notification -->
  <style>
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ef4444;
      color: white;
      border-radius: 50%;
      padding: 2px 6px;
      font-size: 0.75rem;
      font-weight: bold;
      min-width: 18px;
      text-align: center;
      animation: pulse 2s infinite;
    }
    
    .action-card {
      position: relative;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    #contactMessagesCard.has-unread {
      border-left: 4px solid #3b82f6;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), transparent);
    }
  </style>
  
  <script>
    // Check for unread contact messages
    async function checkUnreadMessages() {
      try {
        const response = await fetch('/api/contact-messages/unread-count');
        const result = await response.json();
        
        const badge = document.getElementById('unreadBadge');
        const card = document.getElementById('contactMessagesCard');
        
        if (result.count > 0) {
          badge.textContent = result.count;
          badge.style.display = 'block';
          card.classList.add('has-unread');
        } else {
          badge.style.display = 'none';
          card.classList.remove('has-unread');
        }
      } catch (error) {
        console.error('Error checking unread messages:', error);
      }
    }
    
    // Check on page load
    document.addEventListener('DOMContentLoaded', checkUnreadMessages);
    
    // Check every 30 seconds
    setInterval(checkUnreadMessages, 30000);
  </script>
</head>
<body>
  <!-- Navigation Header -->
  <nav class="dashboard-nav">
    <div class="nav-container">
      <div class="nav-brand">
        <h2>🚀 Trigger Deploy</h2>
      </div>
      <div class="nav-menu">
        <a href="/dashboard" class="nav-item active">🏠 Dashboard</a>
        <a href="/deploy-servers" class="nav-item">🔐 Deploy</a>
        <a href="/metrics" class="nav-item">📊 Metrics</a>
        <a href="/services-monitor" class="nav-item">🐳 Services</a>
        <a href="/help" class="nav-item">🆘 Help</a>
        <a href="/docs" class="nav-item">📚 API Docs</a>
      </div>
      <div class="nav-user">
        <div class="user-info">
          <span class="user-name" id="userName">User</span>
          <span class="user-role" id="userRole">admin</span>
        </div>
        <div class="user-actions">
          <button onclick="showUserMenu()" class="user-menu-btn">⚙️</button>
          <button onclick="logout()" class="logout-btn">🚪</button>
        </div>
      </div>
    </div>
  </nav>

  <div class="dashboard-container">
    <!-- Welcome Section -->
    <div class="welcome-section">
      <div class="welcome-content">
        <h1>Welcome to Dashboard</h1>
        <p>Automated deployment management platform - <span id="currentTime"></span></p>
      </div>
      <div class="system-status-indicator">
        <span class="status-dot" id="systemStatusDot"></span>
        <span id="systemStatusText">System Online</span>
      </div>
    </div>
    
    <!-- Quick Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">🚀</div>
        <div class="stat-info">
          <div class="stat-value" id="totalDeployments">-</div>
          <div class="stat-label">Total Deployments</div>
          <div class="stat-description">All deployment operations</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">✅</div>
        <div class="stat-info">
          <div class="stat-value" id="successfulDeployments">-</div>
          <div class="stat-label">Successful Deployments</div>
          <div class="stat-description">Completed successfully</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">🖥️</div>
        <div class="stat-info">
          <div class="stat-value" id="activeServers">-</div>
          <div class="stat-label">Active Servers</div>
          <div class="stat-description">Connected and available</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">🐳</div>
        <div class="stat-info">
          <div class="stat-value" id="runningServices">-</div>
          <div class="stat-label">Docker Services</div>
          <div class="stat-description">Running containers</div>
        </div>
      </div>
    </div>

    <div class="content">
      <!-- Quick Actions -->
      <div class="quick-actions-section">
        <h3>🎯 Quick Actions</h3>
        <div class="actions-grid">
          <a href="/deploy-servers" class="action-card">
            <div class="action-icon">🔐</div>
            <div class="action-content">
              <h4>Deploy to Servers</h4>
              <p>Trigger deployment to configured servers</p>
            </div>
          </a>
          
          <button onclick="loadLogList()" class="action-card action-button">
            <div class="action-icon">📁</div>
            <div class="action-content">
              <h4>Browse Logs</h4>
              <p>View deployment and system logs</p>
            </div>
          </button>
          
          <button onclick="showHealthInput()" class="action-card action-button">
            <div class="action-icon">💗</div>
            <div class="action-content">
              <h4>Health Check</h4>
              <p>Test system and server connectivity</p>
            </div>
          </button>
          
          <a href="/services-monitor" class="action-card">
            <div class="action-icon">🐳</div>
            <div class="action-content">
              <h4>Services Monitor</h4>
              <p>Monitor Docker containers and services</p>
            </div>
          </a>
          
          <a href="/metrics" class="action-card">
            <div class="action-icon">📊</div>
            <div class="action-content">
              <h4>Metrics Dashboard</h4>
              <p>View system metrics and analytics</p>
            </div>
          </a>
          
          <a href="/docs" class="action-card">
            <div class="action-icon">📚</div>
            <div class="action-content">
              <h4>API Documentation</h4>
              <p>Swagger UI - Interactive API docs</p>
            </div>
          </a>
          
          <a href="/help" class="action-card">
            <div class="action-icon">🆘</div>
            <div class="action-content">
              <h4>Help Center</h4>
              <p>FAQ, tutorials, and support</p>
            </div>
          </a>
          
          <a href="/admin/contact-messages" class="action-card" id="contactMessagesCard">
            <div class="action-icon">📧</div>
            <div class="action-content">
              <h4>Contact Messages</h4>
              <p>View and manage customer inquiries</p>
              <span class="notification-badge" id="unreadBadge" style="display: none;"></span>
            </div>
          </a>
        </div>
      </div>

      <!-- Health Input - Hidden by default -->
      <div id="healthInputContainer" class="health-input-section hidden">
        <div class="health-input-card">
          <h4>🔍 System Health Check</h4>
          <div class="health-form">
            <input 
              id="healthTarget" 
              class="form-control" 
              placeholder="Enter domain for health check (default: google.co.id)" 
            />
            <div class="health-buttons">
              <button onclick="executeHealthCheck()" class="btn btn-success">
                ✅ Execute Check
              </button>
              <button onclick="cancelHealthCheck()" class="btn btn-secondary">
                ❌ Cancel
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Status Display Area -->
      <div id="status" class="alert hidden"></div>

      <!-- Health Status Display -->
      <div id="healthStatus" class="health-display hidden">
        <h3>🏥 System Health Check</h3>
        <div id="healthContent"></div>
      </div>

      <!-- Recent Activity -->
      <div class="recent-activity-section">
        <h3>📋 Recent Activity</h3>
        <div id="recentActivity" class="activity-list">
          <!-- Activity items will be loaded here -->
        </div>
      </div>

      <!-- Log Output Display -->
      <div id="logOutput" class="log-output hidden"></div>

      <!-- Log List Display -->
      <div id="logListBox" class="log-container hidden">
        <h3>📂 Deployment Logs</h3>
        <div id="logList" class="log-list"></div>
      </div>
    </div>
  </div>

  <!-- User Menu Modal -->
  <div id="userMenuModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>👤 User Settings</h3>
        <button type="button" class="modal-close" onclick="closeUserMenu()">✖️</button>
      </div>
      <div class="modal-body">
        <div class="user-profile">
          <div class="profile-info">
            <strong id="profileName">User</strong>
            <span id="profileRole">admin</span>
          </div>
        </div>
        <div class="settings-options">
          <label class="setting-item">
            <input type="checkbox" id="darkModeToggle">
            <span>🌙 Dark Mode</span>
          </label>
          <label class="setting-item">
            <input type="checkbox" id="notificationsToggle" checked>
            <span>🔔 Notifications</span>
          </label>
          <label class="setting-item">
            <input type="checkbox" id="autoRefreshToggle" checked>
            <span>🔄 Auto Refresh</span>
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" onclick="saveUserSettings()" class="btn btn-primary">
          💾 Save Settings
        </button>
        <button type="button" onclick="logout()" class="btn btn-danger">
          🚪 Logout
        </button>
      </div>
    </div>
  </div>

  <script src="/static/js/home.js"></script>
  <script src="/static/js/dashboard.js"></script>
</body>
</html>