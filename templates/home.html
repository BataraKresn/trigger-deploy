{% extends "base.html" %}

{% block title %}Dashboard - Trigger Deploy{% endblock %}
{% block description %}Monitor and manage your infrastructure services{% endblock %}

{% set current_page = "dashboard" %}
{% set show_nav = true %}
{% set show_footer = true %}

{% block nav_controls %}
<button id="refreshBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition duration-200">
    <i class="fas fa-sync-alt mr-1"></i>Refresh
</button>
<span class="text-sm text-gray-500">
    <i class="fas fa-clock mr-1"></i>
    Last updated: <span id="lastUpdated">--:--:--</span>
</span>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 animate-fade-in">
    <!-- Dashboard Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 flex items-center">
            <i class="fas fa-tachometer-alt mr-3 text-blue-500"></i>
            Dashboard
        </h1>
        <p class="text-gray-600 mt-2">Monitor and manage your infrastructure services</p>
    </div>

    <!-- Summary Statistics -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-white transform hover:scale-105 transition duration-300">
            <div class="flex items-center">
                <div class="flex-1">
                    <p class="text-blue-100">Total Services</p>
                    <p class="text-3xl font-bold" id="totalServices">
                        <i class="fas fa-spinner fa-spin"></i>
                    </p>
                </div>
                <i class="fas fa-server text-2xl text-blue-200"></i>
            </div>
        </div>
        
        <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-white transform hover:scale-105 transition duration-300">
            <div class="flex items-center">
                <div class="flex-1">
                    <p class="text-green-100">Healthy Services</p>
                    <p class="text-3xl font-bold" id="healthyServices">
                        <i class="fas fa-spinner fa-spin"></i>
                    </p>
                </div>
                <i class="fas fa-check-circle text-2xl text-green-200"></i>
            </div>
        </div>
        
        <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl p-6 text-white transform hover:scale-105 transition duration-300">
            <div class="flex items-center">
                <div class="flex-1">
                    <p class="text-yellow-100">Issues</p>
                    <p class="text-3xl font-bold" id="unhealthyServices">
                        <i class="fas fa-spinner fa-spin"></i>
                    </p>
                </div>
                <i class="fas fa-exclamation-triangle text-2xl text-yellow-200"></i>
            </div>
        </div>
        
        <div class="bg-gradient-to-r from-red-500 to-red-600 rounded-xl p-6 text-white transform hover:scale-105 transition duration-300">
            <div class="flex items-center">
                <div class="flex-1">
                    <p class="text-red-100">Critical Down</p>
                    <p class="text-3xl font-bold" id="criticalDown">
                        <i class="fas fa-spinner fa-spin"></i>
                    </p>
                </div>
                <i class="fas fa-times-circle text-2xl text-red-200"></i>
            </div>
        </div>
    </div>

    <!-- Services Grid -->
    <div class="mb-8">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">
            <i class="fas fa-list-ul mr-2"></i>Services Status
        </h2>
        <div id="servicesContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Loading State -->
            <div class="col-span-full flex justify-center items-center py-12">
                <div class="text-center">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                    <p class="text-gray-600">Loading services...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="mb-8">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">
            <i class="fas fa-bolt mr-2"></i>Quick Actions
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Deploy Services -->
            <a href="/deploy-servers" class="group bg-white rounded-xl p-6 border border-gray-200 hover:border-blue-300 hover:shadow-lg transition duration-300 transform hover:-translate-y-1">
                <div class="text-center">
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white mx-auto mb-4 group-hover:scale-110 transition duration-300">
                        <i class="fas fa-cloud-upload-alt text-xl"></i>
                    </div>
                    <h3 class="font-semibold text-gray-900 mb-2">Deploy Services</h3>
                    <p class="text-sm text-gray-600 mb-4">Deploy to your servers</p>
                    <div class="inline-flex items-center text-blue-600 text-sm font-medium">
                        Start Deploy <i class="fas fa-arrow-right ml-1"></i>
                    </div>
                </div>
            </a>
            
            <!-- Monitor Services -->
            <a href="/services-monitor" class="group bg-white rounded-xl p-6 border border-gray-200 hover:border-purple-300 hover:shadow-lg transition duration-300 transform hover:-translate-y-1">
                <div class="text-center">
                    <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-purple-600 rounded-full flex items-center justify-center text-white mx-auto mb-4 group-hover:scale-110 transition duration-300">
                        <i class="fas fa-chart-line text-xl"></i>
                    </div>
                    <h3 class="font-semibold text-gray-900 mb-2">Monitor Services</h3>
                    <p class="text-sm text-gray-600 mb-4">Real-time service monitoring</p>
                    <div class="inline-flex items-center text-purple-600 text-sm font-medium">
                        View Monitor <i class="fas fa-arrow-right ml-1"></i>
                    </div>
                </div>
            </a>
            
            <!-- View Metrics -->
            <a href="/metrics" class="group bg-white rounded-xl p-6 border border-gray-200 hover:border-green-300 hover:shadow-lg transition duration-300 transform hover:-translate-y-1">
                <div class="text-center">
                    <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center text-white mx-auto mb-4 group-hover:scale-110 transition duration-300">
                        <i class="fas fa-chart-bar text-xl"></i>
                    </div>
                    <h3 class="font-semibold text-gray-900 mb-2">View Metrics</h3>
                    <p class="text-sm text-gray-600 mb-4">System performance metrics</p>
                    <div class="inline-flex items-center text-green-600 text-sm font-medium">
                        View Metrics <i class="fas fa-arrow-right ml-1"></i>
                    </div>
                </div>
            </a>
            
            <!-- User Management -->
            <a href="/users" class="group bg-white rounded-xl p-6 border border-gray-200 hover:border-indigo-300 hover:shadow-lg transition duration-300 transform hover:-translate-y-1">
                <div class="text-center">
                    <div class="w-12 h-12 bg-gradient-to-r from-indigo-500 to-indigo-600 rounded-full flex items-center justify-center text-white mx-auto mb-4 group-hover:scale-110 transition duration-300">
                        <i class="fas fa-users text-xl"></i>
                    </div>
                    <h3 class="font-semibold text-gray-900 mb-2">User Management</h3>
                    <p class="text-sm text-gray-600 mb-4">Manage system users</p>
                    <div class="inline-flex items-center text-indigo-600 text-sm font-medium">
                        Manage Users <i class="fas fa-arrow-right ml-1"></i>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900">
                <i class="fas fa-history mr-2 text-blue-500"></i>
                Recent Activity
            </h3>
        </div>
        <div class="p-6">
            <div id="recentActivity" class="space-y-4">
                <!-- Activity items will be loaded here -->
                <div class="flex items-center text-gray-500">
                    <i class="fas fa-info-circle mr-2"></i>
                    <span class="text-sm">Loading recent activity...</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block footer_subtitle %}Infrastructure deployment and monitoring{% endblock %}

{% block extra_js %}
<script>
    class DashboardManager {
        constructor() {
            this.services = [];
            this.init();
        }
        
        async init() {
            await this.loadServices();
            this.setupEventListeners();
            this.startAutoRefresh();
        }
        
        setupEventListeners() {
            const refreshBtn = document.getElementById('refreshBtn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => this.refreshServices());
            }
        }
        
        async loadServices() {
            try {
                console.log('üì° Loading dashboard data...');
                const response = await fetch('/api/services/status');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                this.services = data;
                this.updateDashboard();
                updateLastUpdated();
                
            } catch (error) {
                console.error('‚ùå Failed to load services:', error);
                this.showError('Failed to load dashboard data: ' + error.message);
            }
        }
        
        async refreshServices() {
            const refreshBtn = document.getElementById('refreshBtn');
            if (refreshBtn) {
                refreshBtn.disabled = true;
                refreshBtn.innerHTML = '<i class="fas fa-sync-alt fa-spin mr-1"></i>Refreshing...';
            }
            
            await this.loadServices();
            
            if (refreshBtn) {
                refreshBtn.disabled = false;
                refreshBtn.innerHTML = '<i class="fas fa-sync-alt mr-1"></i>Refresh';
            }
            
            showNotification('Dashboard refreshed successfully', 'success');
        }
        
        updateDashboard() {
            this.updateSummaryStats();
            this.updateServiceCards();
        }
        
        updateSummaryStats() {
            const summary = this.services.summary || {};
            
            this.updateStat('totalServices', summary.total_services || 0);
            this.updateStat('healthyServices', summary.healthy_services || 0);
            this.updateStat('unhealthyServices', summary.unhealthy_services || 0);
            this.updateStat('criticalDown', summary.critical_down || 0);
        }
        
        updateStat(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value;
                
                // Add pulse animation for critical stats
                if ((elementId === 'criticalDown' || elementId === 'unhealthyServices') && value > 0) {
                    element.parentElement.parentElement.classList.add('animate-pulse-slow');
                } else {
                    element.parentElement.parentElement.classList.remove('animate-pulse-slow');
                }
            }
        }
        
        updateServiceCards() {
            const container = document.getElementById('servicesContainer');
            if (!container) return;
            
            const localServices = this.services.local_services || [];
            const remoteServices = this.services.remote_services || [];
            const allServices = [...localServices, ...remoteServices];
            
            if (allServices.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-server text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-600 text-lg font-medium">No services configured</p>
                        <p class="text-gray-500 text-sm">Add services to your configuration to start monitoring</p>
                        <a href="/docs" class="inline-block mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-200">
                            <i class="fas fa-book mr-2"></i>View Documentation
                        </a>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = allServices.map(service => this.createServiceCard(service)).join('');
        }
        
        createServiceCard(service) {
            const status = service.status || 'unknown';
            const { color, bgColor, icon } = this.getStatusStyles(status);
            const isCritical = service.critical && status !== 'healthy';
            
            return `
                <div class="bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition duration-200 ${isCritical ? 'border-2 border-red-200 bg-red-50' : 'border border-gray-200'}">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 ${bgColor} rounded-lg flex items-center justify-center text-white mr-3">
                                <i class="fas ${this.getServiceIcon(service)} ${isCritical ? 'animate-pulse' : ''}"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-900">${service.name || 'Unknown Service'}</h3>
                                <p class="text-sm text-gray-500">${service.description || 'No description'}</p>
                            </div>
                        </div>
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${color}">
                            <i class="fas ${icon} mr-1"></i>${status.toUpperCase()}
                        </span>
                    </div>
                    
                    <div class="space-y-2 text-sm">
                        ${service.url ? `
                            <div class="flex justify-between">
                                <span class="text-gray-600">URL:</span>
                                <span class="font-mono text-xs text-gray-900 truncate max-w-32">${service.url}</span>
                            </div>
                        ` : ''}
                        
                        ${service.port ? `
                            <div class="flex justify-between">
                                <span class="text-gray-600">Port:</span>
                                <span class="text-gray-900">${service.port}</span>
                            </div>
                        ` : ''}
                        
                        ${service.response_time ? `
                            <div class="flex justify-between">
                                <span class="text-gray-600">Response Time:</span>
                                <span class="text-gray-900">${service.response_time}${typeof service.response_time === 'number' ? 'ms' : ''}</span>
                            </div>
                        ` : ''}
                        
                        <div class="flex justify-between">
                            <span class="text-gray-600">Last Check:</span>
                            <span class="text-gray-900">${this.formatTimestamp(service.timestamp)}</span>
                        </div>
                        
                        ${service.critical ? `
                            <div class="flex justify-between">
                                <span class="text-red-600">Priority:</span>
                                <span class="px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium">Critical</span>
                            </div>
                        ` : ''}
                    </div>
                    
                    ${service.message && status !== 'healthy' ? `
                        <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <p class="text-sm text-yellow-800">
                                <i class="fas fa-exclamation-triangle mr-1"></i>
                                ${service.message}
                            </p>
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        getStatusStyles(status) {
            switch (status.toLowerCase()) {
                case 'healthy':
                case 'running':
                case 'online':
                    return {
                        color: 'bg-green-100 text-green-700',
                        bgColor: 'bg-green-500',
                        icon: 'fa-check-circle'
                    };
                case 'unhealthy':
                case 'offline':
                case 'error':
                    return {
                        color: 'bg-red-100 text-red-700',
                        bgColor: 'bg-red-500',
                        icon: 'fa-times-circle'
                    };
                case 'warning':
                    return {
                        color: 'bg-yellow-100 text-yellow-700',
                        bgColor: 'bg-yellow-500',
                        icon: 'fa-exclamation-triangle'
                    };
                default:
                    return {
                        color: 'bg-gray-100 text-gray-700',
                        bgColor: 'bg-gray-500',
                        icon: 'fa-question-circle'
                    };
            }
        }
        
        getServiceIcon(service) {
            if (service.type === 'docker') return 'fa-docker';
            if (service.url || service.type === 'http') return 'fa-globe';
            return 'fa-server';
        }
        
        formatTimestamp(timestamp) {
            if (!timestamp) return 'Never';
            try {
                const date = new Date(timestamp);
                return date.toLocaleTimeString();
            } catch {
                return 'Invalid';
            }
        }
        
        showError(message) {
            const container = document.getElementById('servicesContainer');
            if (container) {
                container.innerHTML = `
                    <div class="col-span-full">
                        <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-red-500 text-xl mr-3"></i>
                                <div>
                                    <h4 class="text-red-800 font-semibold">Error Loading Services</h4>
                                    <p class="text-red-600">${message}</p>
                                    <button onclick="dashboardManager.refreshServices()" class="mt-3 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition duration-200">
                                        <i class="fas fa-sync-alt mr-1"></i>Try Again
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            showNotification(message, 'error');
        }
        
        startAutoRefresh() {
            // Refresh every 30 seconds
            setInterval(() => {
                this.loadServices();
            }, 30000);
        }
    }
    
    // Initialize dashboard
    let dashboardManager;
    document.addEventListener('DOMContentLoaded', function() {
        dashboardManager = new DashboardManager();
    });
</script>
{% endblock %}
    </div>

    <!-- Summary Statistics -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-white">
        <div class="flex items-center">
          <div class="flex-1">
            <p class="text-blue-100">Total Services</p>
            <p class="text-3xl font-bold" id="totalServices">0</p>
          </div>
          <i class="fas fa-server text-2xl text-blue-200"></i>
        </div>
      </div>
      
      <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-white">
        <div class="flex items-center">
          <div class="flex-1">
            <p class="text-green-100">Healthy</p>
            <p class="text-3xl font-bold" id="healthyServices">0</p>
          </div>
          <i class="fas fa-check-circle text-2xl text-green-200"></i>
        </div>
      </div>
      
      <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl p-6 text-white">
        <div class="flex items-center">
          <div class="flex-1">
            <p class="text-yellow-100">Issues</p>
            <p class="text-3xl font-bold" id="unhealthyServices">0</p>
          </div>
          <i class="fas fa-exclamation-triangle text-2xl text-yellow-200"></i>
        </div>
      </div>
      
      <div class="bg-gradient-to-r from-red-500 to-red-600 rounded-xl p-6 text-white">
        <div class="flex items-center">
          <div class="flex-1">
            <p class="text-red-100">Critical Down</p>
            <p class="text-3xl font-bold" id="criticalDown">0</p>
          </div>
          <i class="fas fa-times-circle text-2xl text-red-200"></i>
        </div>
      </div>
    </div>

    <!-- Auto-refresh Controls -->
    <div class="bg-white rounded-xl p-4 mb-8 border border-gray-200">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
        <div class="flex items-center mb-3 sm:mb-0">
          <input type="checkbox" id="autoRefreshToggle" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
          <label for="autoRefreshToggle" class="ml-2 text-sm font-medium text-gray-700">
            <i class="fas fa-sync-alt mr-1"></i>Auto Refresh (30s)
          </label>
        </div>
        <div class="text-sm text-gray-500">
          <i class="fas fa-info-circle mr-1"></i>Dashboard updates automatically every 30 seconds
        </div>
      </div>
    </div>

    <!-- Services Grid -->
    <div class="mb-8">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">
        <i class="fas fa-list-ul mr-2"></i>Services Status
      </h2>
      <div id="servicesContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Loading State -->
        <div class="col-span-full flex justify-center items-center py-12">
          <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
            <p class="text-gray-600">Loading services...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="mb-8">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">
        <i class="fas fa-bolt mr-2"></i>Quick Actions
      </h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Deploy Services -->
        <a href="/deploy-servers" class="group bg-white rounded-xl p-6 border border-gray-200 hover:border-blue-300 hover:shadow-lg transition duration-300 transform hover:-translate-y-1">
          <div class="text-center">
            <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white mx-auto mb-4 group-hover:scale-110 transition duration-300">
              <i class="fas fa-cloud-upload-alt text-xl"></i>
            </div>
            <h3 class="font-semibold text-gray-900 mb-2">Deploy Services</h3>
            <p class="text-sm text-gray-600 mb-4">Deploy applications to your servers</p>
            <div class="inline-flex items-center text-blue-600 text-sm font-medium">
              Go to Deploy <i class="fas fa-arrow-right ml-1"></i>
            </div>
          </div>
        </a>
        
        <!-- View Metrics -->
        <a href="/metrics" class="group bg-white rounded-xl p-6 border border-gray-200 hover:border-green-300 hover:shadow-lg transition duration-300 transform hover:-translate-y-1">
          <div class="text-center">
            <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center text-white mx-auto mb-4 group-hover:scale-110 transition duration-300">
              <i class="fas fa-chart-line text-xl"></i>
            </div>
            <h3 class="font-semibold text-gray-900 mb-2">View Metrics</h3>
            <p class="text-sm text-gray-600 mb-4">Monitor system performance</p>
            <div class="inline-flex items-center text-green-600 text-sm font-medium">
              View Metrics <i class="fas fa-arrow-right ml-1"></i>
            </div>
          </div>
        </a>
        
        <!-- User Management -->
        <a href="/users" class="group bg-white rounded-xl p-6 border border-gray-200 hover:border-purple-300 hover:shadow-lg transition duration-300 transform hover:-translate-y-1">
          <div class="text-center">
            <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-purple-600 rounded-full flex items-center justify-center text-white mx-auto mb-4 group-hover:scale-110 transition duration-300">
              <i class="fas fa-users text-xl"></i>
            </div>
            <h3 class="font-semibold text-gray-900 mb-2">User Management</h3>
            <p class="text-sm text-gray-600 mb-4">Manage accounts and permissions</p>
            <div class="inline-flex items-center text-purple-600 text-sm font-medium">
              Manage Users <i class="fas fa-arrow-right ml-1"></i>
            </div>
          </div>
        </a>
        
        <!-- Documentation -->
        <a href="/docs" class="group bg-white rounded-xl p-6 border border-gray-200 hover:border-orange-300 hover:shadow-lg transition duration-300 transform hover:-translate-y-1">
          <div class="text-center">
            <div class="w-12 h-12 bg-gradient-to-r from-orange-500 to-orange-600 rounded-full flex items-center justify-center text-white mx-auto mb-4 group-hover:scale-110 transition duration-300">
              <i class="fas fa-book text-xl"></i>
            </div>
            <h3 class="font-semibold text-gray-900 mb-2">Documentation</h3>
            <p class="text-sm text-gray-600 mb-4">API docs and help guides</p>
            <div class="inline-flex items-center text-orange-600 text-sm font-medium">
              View Docs <i class="fas fa-arrow-right ml-1"></i>
            </div>
          </div>
        </a>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-white border-t border-gray-200 mt-12">
    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
      <div class="flex flex-col sm:flex-row justify-between items-center">
        <div class="flex items-center mb-4 sm:mb-0">
          <div class="w-6 h-6 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center text-white mr-2">
            <i class="fas fa-rocket text-xs"></i>
          </div>
          <div>
            <h3 class="text-sm font-semibold text-gray-900">Trigger Deploy Server</h3>
            <p class="text-xs text-gray-600">Infrastructure deployment and monitoring</p>
          </div>
        </div>
        <div class="text-sm text-gray-500">
          <i class="fas fa-clock mr-1"></i>
          Server Time: <span id="serverTime">--:--:--</span>
        </div>
      </div>
    </div>
  </footer>

  <!-- Services Monitor JS -->
  <script src="/static/services-monitor.js"></script>
  
  <script>
    // User menu toggle
    document.getElementById('userMenuButton').addEventListener('click', function(e) {
      e.stopPropagation();
      const menu = document.getElementById('userMenu');
      menu.classList.toggle('hidden');
    });
    
    // Close user menu when clicking outside
    document.addEventListener('click', function() {
      document.getElementById('userMenu').classList.add('hidden');
    });
    
    // Logout functionality
    document.getElementById('logoutBtn').addEventListener('click', async function() {
      try {
        const response = await fetch('/api/auth/logout', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          credentials: 'same-origin'
        });

        if (response.ok) {
          window.location.href = '/login?message=Successfully logged out';
        } else {
          alert('Failed to logout. Please try again.');
        }
      } catch (error) {
        console.error('Logout error:', error);
        alert('Network error. Please try again.');
      }
    });
    
    // Update server time
    function updateServerTime() {
      document.getElementById('serverTime').textContent = new Date().toLocaleString();
    }
    
    updateServerTime();
    setInterval(updateServerTime, 1000);
  </script>
</body>
</html>
